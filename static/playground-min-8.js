function indent(e){return format(e,!0,!0)}function compact(e){return format(e,!1,!0)}function compactAndRemoveComment(e){return format(e,!1,!1)}function format(e,t,n){e.endsWith(";")&&(e=e.slice(0,-1));var r="",a=!1,c=!1,i=0,s=0;for(e.startsWith("db.")&&(s=e.indexOf("(")+1,r+=e.substring(0,s));s<e.length;){var m=e.charAt(s);if(" "!==m&&"\n"!==m&&"\t"!==m){switch(a&&"]"!==m&&"}"!==m&&(a=!1,i++,r+=t?newline(i):""),m){case"(":c=!0,r+=m;break;case")":c=!1,r+=m;break;case"{":case"[":a=!0,r+=m;break;case",":r+=m,t&&(r+=c?" ":newline(i));break;case":":r+=m,t&&(r+=" ");break;case"}":case"]":a?a=!1:(i--,r+=t?newline(i):""),r+=m;break;case'"':case"'":var o=m;for(r+='"',s++,m=e.charAt(s);m!==o&&s<e.length;)r+=m,s++,m=e.charAt(s);s!=e.length&&(r+='"');break;case"n":var h=e.substring(s,s+9);if("new Date("===h){for(r+=h,s+=h.length,m=e.charAt(s);")"!==m&&s<e.length;)r+=m,s++,m=e.charAt(s);s!=e.length&&(r+=")")}else r+=m;break;case"/":if(e.length>=s+1&&"/"==e.charAt(s+1)){if(!n){for(s+=2;"\n"!=m&&s<e.length;)s++,m=e.charAt(s);continue}for(r+="/**",s+=2,m=e.charAt(s);"\n"!=m&&s<e.length;)r+=m,s++,m=e.charAt(s);r+="*/",t&&(r+=newline(i))}else if(e.length>=s+2&&"*"==e.charAt(s+1)&&"*"==e.charAt(s+2)){if(start=s+3,s=e.indexOf("*/",start),!n){-1==s?(s=start,"/"==e.charAt(s)&&s++):s+=2;continue}if(-1==s){s=start,"/"==e.charAt(s)&&s++;continue}comment=e.substring(start,s),r+="/**",t?(comment=comment.replace(/[\s]+\*/gm,"*").trimRight(),comment=comment.replace(/\*/gm,newline(i)+"*"),0<comment.indexOf("*")&&(comment+=newline(i)),r+=comment):r+=comment.replace(/[\s]+\*/gm,"*").trimRight(),r+="*/",s++,t&&(r+=newline(i))}else if(e.length>=s+1&&"*"==e.charAt(s+1)){if(start=s+2,s=e.indexOf("*/",start),!n){-1==s?s=start:s+=2;continue}if(-1==s){s=start;continue}comment=e.substring(start,s),r+="/**",t?(comment=comment.replace(/[\s]*\n[\s]+/gm,"* ").trimRight(),comment=comment.replace(/\*/gm,newline(i)+"*"),0<comment.indexOf("*")&&(comment+=newline(i)),r+=comment):r+=comment.replace(/[\s]*\n[\s]+/gm,"* ").trimRight(),r+="*/",s++,t&&(r+=newline(i))}else{for(r+=m,s++,m=e.charAt(s);"/"!==m&&s<e.length;)r+=m,s++,m=e.charAt(s);s!=e.length&&(r+="/")}break;default:r+=m}s++}else s++}return r}function newline(e){for(var t="\n",n=0;n<e;n++)t+="  ";return t}function isConfigValid(e,t){var n=compactAndRemoveComment(e);return!(!n.startsWith("[")||!n.endsWith("]"))||"bson"===t&&/^\s*db\s*=\s*\{[\s\S]*\}$/.test(n)}function isQueryValid(e){e.endsWith(";")&&(e=e.slice(0,-1));var t=compactAndRemoveComment(e);if(!/^db\..(\w*)\.(find|aggregate)\([\s\S]*\)$/.test(t))return!1;var n=t.indexOf("(")+1;return query=t.substring(n,t.length-1),!(""!==query&&!query.endsWith("}")&&!query.endsWith("]"))}