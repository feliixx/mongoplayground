function compact(e){return format(e,!1,!0)}function compactAndRemoveComment(e){return format(e,!1,!1)}function indent(e){return format(e,!0,!0)}function format(e,t,n){var r="",a=!1,c=!1,i=0,m=0,s=e.charAt(m);for(e.startsWith("db.")&&(m=e.indexOf("(")+1,r+=e.substring(0,m));m<e.length;)if(" "!==(s=e.charAt(m))&&"\n"!==s&&"\t"!==s){switch(a&&"]"!==s&&"}"!==s&&(a=!1,i++,r+=t?newline(i):""),s){case"(":c=!0,r+=s;break;case")":c=!1,r+=s;break;case"{":case"[":a=!0,r+=s;break;case",":r+=s,t&&(r+=c?" ":newline(i));break;case":":r+=s,t&&(r+=" ");break;case"}":case"]":a?a=!1:(i--,r+=t?newline(i):""),r+=s;break;case'"':case"'":var o=s;for(r+='"',m++,s=e.charAt(m);s!==o&&m<e.length;)r+=s,m++,s=e.charAt(m);m!=e.length&&(r+='"');break;case"n":var h=e.substring(m,m+9);if("new Date("===h){for(r+=h,m+=h.length,s=e.charAt(m);")"!==s&&m<e.length;)r+=s,m++,s=e.charAt(m);m!=e.length&&(r+=")")}else r+=s;break;case"/":if(e.length>=m+1&&"/"==e.charAt(m+1)){if(!n){for(m+=2;"\n"!=s&&m<e.length;)m++,s=e.charAt(m);continue}for(r+="/**",m+=2,s=e.charAt(m);"\n"!=s&&m<e.length;)r+=s,m++,s=e.charAt(m);r+="*/",t&&(r+=newline(i))}else if(e.length>=m+2&&"*"==e.charAt(m+1)&&"*"==e.charAt(m+2)){if(start=m+3,m=e.indexOf("*/",start),!n){m+=2,s=e.charAt(m);continue}if(-1==m){m=start;continue}comment=e.substring(start,m),r+="/**",t?(comment=comment.replace(/[\s]+\*/gm,"*").trimRight(),comment=comment.replace(/\*/gm,newline(i)+"*"),0<comment.indexOf("*")&&(comment+=newline(i)),r+=comment):r+=comment.replace(/[\s]+\*/gm,"*").trimRight(),r+="*/",m++,s=e.charAt(m),t&&(r+=newline(i))}else if(e.length>=m+1&&"*"==e.charAt(m+1)){if(start=m+2,m=e.indexOf("*/",start),!n){m+=2,s=e.charAt(m);continue}if(-1==m){m=start;continue}comment=e.substring(start,m),r+="/**",t?(comment=comment.replace(/[\s]*\n[\s]+/gm,"* ").trimRight(),comment=comment.replace(/\*/gm,newline(i)+"*"),0<comment.indexOf("*")&&(comment+=newline(i)),r+=comment):r+=comment.replace(/[\s]*\n[\s]+/gm,"* ").trimRight(),r+="*/",m++,s=e.charAt(m),t&&(r+=newline(i))}else{for(r+=s,m++,s=e.charAt(m);"/"!==s&&m<e.length;)r+=s,m++,s=e.charAt(m);m!=e.length&&(r+="/")}break;default:r+=s}m++}else m++;return r}function newline(e){for(var t="\n",n=0;n<e;n++)t+="  ";return t}function formatConfig(e,t){var n=compactAndRemoveComment(e);if(!n.startsWith("[")||!n.endsWith("]")){if("bson"!==t)return"invalid";if(!/^\s*db\s*=\s*\{[\s\S]*\}$/.test(n))return"invalid"}return e}function formatQuery(e){var t=e;e.endsWith(";")&&(t=e.slice(0,-1));var n=compactAndRemoveComment(t);if(!/^db\..(\w*)\.(find|aggregate)\([\s\S]*\)$/.test(n))return"invalid";var r=n.indexOf("(")+1;return query=n.substring(r,n.length-1),""===query||query.endsWith("}")||query.endsWith("]")?t:"invalid"}