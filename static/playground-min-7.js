function compact(e){return format(e,!1,!0)}function compactAndRemoveComment(e){return format(e,!1,!1)}function indent(e){return format(e,!0,!0)}function format(e,t,n){var r="",a=!1,c=!1,i=0,s=0,o=e.charAt(s);for(e.startsWith("db.")&&(s=e.indexOf("(")+1,r+=e.substring(0,s));s<e.length;)if(" "!==(o=e.charAt(s))&&"\n"!==o&&"\t"!==o){switch(a&&"]"!==o&&"}"!==o&&(a=!1,i++,r+=t?newline(i):""),o){case"(":c=!0,r+=o;break;case")":c=!1,r+=o;break;case"{":case"[":a=!0,r+=o;break;case",":r+=o,t&&(r+=c?" ":newline(i));break;case":":r+=o,t&&(r+=" ");break;case"}":case"]":a?a=!1:(i--,r+=t?newline(i):""),r+=o;break;case'"':case"'":var m=o;for(r+='"',s++,o=e.charAt(s);o!==m&&s<e.length;)r+=o,s++,o=e.charAt(s);s!=e.length&&(r+='"');break;case"n":var f=e.substring(s,s+9);if("new Date("===f){for(r+=f,s+=f.length,o=e.charAt(s);")"!==o&&s<e.length;)r+=o,s++,o=e.charAt(s);s!=e.length&&(r+=")")}else r+=o;break;case"/":if(e.length>=s+1&&"/"==e.charAt(s+1)){if(!n){for(s+=2;"\n"!=o&&s<e.length;)s++,o=e.charAt(s);continue}for(r+="/**",s+=2,o=e.charAt(s);"\n"!=o&&s<e.length;)r+=o,s++,o=e.charAt(s);r+="*/",t&&(r+=newline(i))}else if(e.length>=s+2&&"*"==e.charAt(s+1)&&"*"==e.charAt(s+2)){if(start=s+3,s=e.indexOf("*/",start),!n){s+=2,o=e.charAt(s);continue}if(r+="/**",-1==s){s=start;continue}comment=e.substring(start,s),t?(comment=comment.replace(/[\s]+\*/gm,"*").trimRight(),comment=comment.replace(/\*/gm,newline(i)+"*"),0<comment.indexOf("*")&&(comment+=newline(i)),r+=comment):r+=comment.replace(/[\s]+\*/gm,"*").trimRight(),r+="*/",s++,o=e.charAt(s),t&&(r+=newline(i))}else{for(r+=o,s++,o=e.charAt(s);"/"!==o&&s<e.length;)r+=o,s++,o=e.charAt(s);s!=e.length&&(r+="/")}break;default:r+=o}s++}else s++;return r}function newline(e){for(var t="\n",n=0;n<e;n++)t+="  ";return t}function formatConfig(e,t){var n=compactAndRemoveComment(e);if(!n.startsWith("[")||!n.endsWith("]")){if("bson"!==t)return"invalid";if(!/^\s*db\s*=\s*\{[\s\S]*\}$/.test(n))return"invalid"}return e}function formatQuery(e){var t=e;e.endsWith(";")&&(t=e.slice(0,-1));var n=compactAndRemoveComment(t);if(!/^db\..(\w*)\.(find|aggregate)\([\s\S]*\)$/.test(n))return"invalid";var r=n.indexOf("(")+1;return query=n.substring(r,n.length-1),""===query||query.endsWith("}")||query.endsWith("]")?t:"invalid"}